<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trading Analytics Institutional</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<style>
:root{
--bg:#0b1220;
--bg2:#111827;
--card:#1f2937;
--card2:#111827;
--text:#e5e7eb;
--sub:#9ca3af;
--accent:#6366f1;
--green:#22c55e;
--red:#ef4444;
}

.light{
--bg:#f3f4f6;
--bg2:#ffffff;
--card:#ffffff;
--card2:#f9fafb;
--text:#111827;
--sub:#6b7280;
}

*{box-sizing:border-box;margin:0;padding:0}
body{
font-family:Inter,system-ui;
background:linear-gradient(135deg,var(--bg),var(--bg2));
color:var(--text);
transition:.3s;
}

.container{
max-width:1500px;
margin:auto;
padding:30px;
}

/* HEADER */
.header{
display:flex;
justify-content:space-between;
align-items:center;
margin-bottom:30px;
}

.header h1{
font-size:24px;
font-weight:600;
}

.toggle-btn{
background:var(--card);
padding:8px 16px;
border-radius:20px;
cursor:pointer;
border:1px solid rgba(255,255,255,.05);
}

/* Upload */
.upload-box{
border:2px dashed var(--accent);
border-radius:18px;
padding:50px;
text-align:center;
margin-bottom:30px;
cursor:pointer;
background:var(--card2);
transition:.3s;
}
.upload-box:hover{
background:rgba(99,102,241,.08);
}
input[type=file]{display:none}

/* KPI CARDS */
.kpi-grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
gap:20px;
margin-bottom:40px;
}

.kpi-card{
background:var(--card);
padding:20px;
border-radius:16px;
position:relative;
overflow:hidden;
transition:.3s;
}
.kpi-card:hover{
transform:translateY(-4px);
box-shadow:0 10px 30px rgba(0,0,0,.3);
}

.kpi-icon{
font-size:18px;
margin-bottom:10px;
opacity:.8;
}

.kpi-label{
font-size:12px;
color:var(--sub);
}

.kpi-value{
font-size:22px;
font-weight:600;
margin-top:6px;
}

/* Charts */
.section-title{
font-size:16px;
margin-bottom:15px;
opacity:.8;
}

.chart-grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(500px,1fr));
gap:30px;
margin-bottom:40px;
}

.chart-card{
background:var(--card);
padding:20px;
border-radius:18px;
height:420px;
position:relative;
}

.chart-card canvas{
position:absolute;
top:0;
left:0;
width:100%!important;
height:100%!important;
}

/* TABLE */
.table-section{
background:var(--card);
padding:20px;
border-radius:18px;
overflow:auto;
}

table{
width:100%;
border-collapse:collapse;
font-size:13px;
}

th,td{
padding:10px;
border-bottom:1px solid rgba(255,255,255,.05);
text-align:center;
}

th{
color:var(--sub);
font-weight:500;
}

@media(max-width:768px){
.chart-grid{grid-template-columns:1fr}
}
</style>
</head>

<body>

<div class="container">

<div class="header">
<h1>ðŸ“Š Trading Analytics Institutional</h1>
<div class="toggle-btn" onclick="toggleTheme()">Toggle Mode</div>
</div>

<div class="upload-box" id="uploadBox">
Drag & Drop Excel File (.xlsx) or Click to Upload
<input type="file" id="fileInput" accept=".xlsx,.xls">
</div>

<div id="dashboard" style="display:none">

<div class="kpi-grid" id="kpiGrid"></div>

<div class="section-title">Performance Overview</div>
<div class="chart-grid">
<div class="chart-card"><canvas id="pnlChart"></canvas></div>
<div class="chart-card"><canvas id="ddChart"></canvas></div>
<div class="chart-card"><canvas id="volumeChart"></canvas></div>
<div class="chart-card"><canvas id="feeChart"></canvas></div>
</div>

<div class="section-title">Trade History</div>
<div class="table-section">
<table id="tradeTable"></table>
</div>

</div>
</div>

<script>
let rawData=[]
let charts={}

function format(n){
return Number(n).toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2})
}

function toggleTheme(){
document.body.classList.toggle("light")
}

function handleFile(file){
const reader=new FileReader()
reader.onload=e=>{
const wb=XLSX.read(new Uint8Array(e.target.result),{type:"array"})
const sheet=wb.Sheets[wb.SheetNames[0]]
rawData=XLSX.utils.sheet_to_json(sheet)
calculate(rawData)
}
reader.readAsArrayBuffer(file)
}

function calculate(data){
let totalPnL=0,totalFees=0,volume=0,wins=0
let cumulative=0,peak=0,maxDD=0
let pnlHist=[],ddHist=[],volHist=[]
data.forEach(tr=>{
let entry=+tr.entry_price
let exit=+tr.exit_price
let qty=+tr.quantity
let fees=(+tr.fees||0)+(+tr.funding_fee||0)+(+tr.network_fee||0)
let pnl=tr.direction==="long"?(exit-entry)*qty-fees:(entry-exit)*qty-fees
totalPnL+=pnl
totalFees+=fees
volume+=entry*qty
if(pnl>0)wins++
cumulative+=pnl
peak=Math.max(peak,cumulative)
let dd=(peak-cumulative)/Math.max(peak,1)*100
maxDD=Math.max(maxDD,dd)
pnlHist.push(cumulative)
ddHist.push(-dd)
volHist.push(volume)
})

renderKPI({totalPnL,totalFees,volume,winRate:wins/data.length*100,trades:data.length,maxDD})
renderCharts(pnlHist,ddHist,volHist,totalFees)
renderTable(data)
document.getElementById("dashboard").style.display="block"
}

function renderKPI(m){
const grid=document.getElementById("kpiGrid")
grid.innerHTML=""
const metrics={
"Total PnL":"$"+format(m.totalPnL),
"Volume":"$"+format(m.volume),
"Total Fees":"$"+format(m.totalFees),
"Win Rate":m.winRate.toFixed(2)+"%",
"Trades":m.trades,
"Max Drawdown":m.maxDD.toFixed(2)+"%"
}
for(let k in metrics){
grid.innerHTML+=`
<div class="kpi-card">
<div class="kpi-icon">ðŸ“ˆ</div>
<div class="kpi-label">${k}</div>
<div class="kpi-value">${metrics[k]}</div>
</div>`
}
}

function createChart(id,type,label,data,labels){
if(charts[id]) charts[id].destroy()
charts[id]=new Chart(document.getElementById(id),{
type:type,
data:{
labels:labels||data.map((_,i)=>i+1),
datasets:[{
label:label,
data:data,
backgroundColor:"rgba(99,102,241,.2)",
borderColor:"#6366f1",
borderWidth:2,
tension:.4
}]
},
options:{
responsive:true,
maintainAspectRatio:false,
interaction:{mode:'index',intersect:false},
plugins:{
tooltip:{backgroundColor:"#111827",padding:12}
}
}
})
}

function renderCharts(pnl,dd,vol,totalFees){
createChart("pnlChart","line","Cumulative PnL",pnl)
createChart("ddChart","line","Drawdown %",dd)
createChart("volumeChart","line","Volume",vol)
createChart("feeChart","doughnut","Fees",[totalFees])
}

function renderTable(data){
let table=document.getElementById("tradeTable")
table.innerHTML=""
if(!data.length)return
let headers=Object.keys(data[0])
table.innerHTML="<tr>"+headers.map(h=>`<th>${h}</th>`).join("")+"</tr>"
data.forEach(row=>{
table.innerHTML+="<tr>"+headers.map(h=>`<td>${row[h]}</td>`).join("")+"</tr>"
})
}

const uploadBox=document.getElementById("uploadBox")
const fileInput=document.getElementById("fileInput")
uploadBox.addEventListener("click",()=>fileInput.click())
fileInput.addEventListener("change",e=>handleFile(e.target.files[0]))
uploadBox.addEventListener("dragover",e=>e.preventDefault())
uploadBox.addEventListener("drop",e=>{
e.preventDefault()
handleFile(e.dataTransfer.files[0])
})
</script>

</body>
</html>